{"version":3,"file":"static/chunks/pages/tiny-code/embed/[id]-e966c5c4ef1169cf.js","mappings":"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","sources":["webpack://_N_E/./node_modules/@babel/standalone/ sync","webpack://_N_E/?bb6b","webpack://_N_E/./pages/tiny-code/components/Previewer/parser/scriptParser/babelTransform.ts","webpack://_N_E/./pages/tiny-code/components/Previewer/types.ts","webpack://_N_E/./pages/tiny-code/components/Previewer/parser/styleParser/cssParser.ts","webpack://_N_E/./pages/tiny-code/components/Previewer/parser/styleParser/sassParser.ts","webpack://_N_E/./pages/tiny-code/components/Previewer/parser/styleParser/index.ts","webpack://_N_E/./pages/tiny-code/components/Previewer/parser/utils.ts","webpack://_N_E/./pages/tiny-code/components/Previewer/parser/index.ts","webpack://_N_E/./pages/tiny-code/components/Previewer/index.tsx","webpack://_N_E/./pages/tiny-code/embed/[id]/index.page.tsx","webpack://_N_E/./pages/tiny-code/components/Previewer/style.module.scss","webpack://_N_E/./pages/tiny-code/embed/[id]/style.module.scss","webpack://_N_E/<anon>"],"sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 25380;\nmodule.exports = webpackEmptyContext;","\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/tiny-code/embed/[id]\",\n      function () {\n        return require(\"private-next-pages/tiny-code/embed/[id]/index.page.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/tiny-code/embed/[id]\"])\n      });\n    }\n  ","import * as Babel from \"@babel/standalone\";\nimport { ParserReturn } from \"../type\";\n\nconst getOptions = (scriptType: string) => {\n  const config = {\n    presets: [],\n    plugins: [],\n  };\n  switch (scriptType) {\n    case \"typescript\":\n      config.plugins.push([\"transform-typescript\"]);\n      break;\n    case \"react-js\":\n      config.presets.push(\"react\");\n      break;\n    case \"react-ts\":\n      config.presets.push(\"react\");\n      config.plugins.push([\n        \"transform-typescript\",\n        {\n          isTSX: true,\n        },\n      ]);\n      break;\n  }\n\n  return config;\n};\n\n// 添加依赖\nconst addDependencies = (scriptType: string): Record<string, string> => {\n  const imports: Record<string, string> = {};\n  switch (scriptType) {\n    case \"react-js\":\n    case \"react-ts\":\n      imports.react = \"https://esm.sh/react\";\n      imports[\"react-dom\"] = \"https://esm.sh/react-dom\";\n      break;\n  }\n\n  return imports;\n};\n\nconst babelTransform = (scriptType: string, input: string) => {\n  const outputCode = Babel.transform(input, getOptions(scriptType)).code;\n  return `<script type=\"module\">${outputCode}</script>`;\n};\n\nexport const transformScript = (\n  scriptType: string,\n  input: string\n): ParserReturn => {\n  try {\n    return {\n      imports: addDependencies(scriptType),\n      code: babelTransform(scriptType, input),\n    };\n  } catch (err) {\n    console.error(err);\n    return { imports: {}, code: \"\" };\n  }\n};\n","export interface PreviewProps {\n  css?: string;\n  cssType?: CSSType;\n  js?: string;\n  html?: string;\n  title?: string;\n  className?: string;\n  codeMap: Map<string, string>;\n}\n\nexport enum CSSType {\n  CSS = \"css\",\n  SASS = \"sass\",\n  LESS = \"less\",\n}\n","import { ParserReturn } from \"../type\";\n\nexport const cssParser = (code: string): ParserReturn => {\n  return {\n    code: `\n    <script type=\"module\">\n      let styleEle = document.getElementById(\"css\");\n      if (!styleEle) {\n        styleEle = document.createElement(\"style\");\n        styleEle.id = \"css\";\n        document.head.appendChild(styleEle);\n      }\n      styleEle.innerHTML = \\`${code}\\`;\n    </script>\n    `,\n  };\n};\n","import { ParserReturn } from \"../type\";\n\nexport const sassParser = (code: string): ParserReturn => {\n  return {\n    imports: {\n      sass: \"https://esm.sh/sass\",\n    },\n    code: `    \n    <script type=\"module\">\n      import * as sass from 'sass';\n    \n      let styleEle = document.getElementById(\"css\");\n      if (!styleEle) {\n        styleEle = document.createElement(\"style\");\n        styleEle.id = \"css\";\n        document.head.appendChild(styleEle);\n      }\n      styleEle.innerHTML = sass.compileString(\\`${code}\\`)?.css;\n    </script>\n    `,\n  };\n};\n","import { CSSType } from \"../../types\";\nimport { ParserReturn } from \"../type\";\nimport { cssParser } from \"./cssParser\";\nimport { sassParser } from \"./sassParser\";\n\nexport const parserMap: Partial<Record<CSSType, (code: string) => ParserReturn>> = {\n  [CSSType.SASS]: sassParser,\n  [CSSType.CSS]: cssParser,\n};\n\nexport const styleParser = (\n  cssType: CSSType = CSSType.CSS,\n  css: string\n): ParserReturn => {\n  return parserMap[cssType]?.(css);\n};\n","export const mergeImports = (\n  ...rest: Record<string, string>[]\n): Record<string, string> => {\n  const imports: Record<string, string> = {};\n  rest.forEach((map) => {\n    if (map) {\n      Object.assign(imports, map);\n    }\n  });\n\n  return imports;\n};\n\nexport const importmapScript = (imports: Record<string, string>): string => {\n  const Obj = {\n    imports,\n  };\n  return `<script type=\"importmap\">${JSON.stringify(Obj, undefined, 2)}</script>`;\n};\n","import { transformScript } from \"./scriptParser/babelTransform\";\nimport { styleParser } from \"./styleParser\";\nimport { CodeParserReturn } from \"./type\";\nimport { importmapScript, mergeImports } from \"./utils\";\n\nexport const codeParser = (codeMap: Map<string, any>): CodeParserReturn => {\n  const cssParserResult = styleParser(\n    codeMap.get(\"cssType\"),\n    codeMap.get(\"css\")\n  );\n  const scriptParserResult = transformScript(\n    codeMap.get(\"scriptType\"),\n    codeMap.get(\"script\") ?? \"\"\n  );\n  return {\n    importMap: importmapScript(\n      mergeImports(cssParserResult.imports, scriptParserResult.imports)\n    ),\n    htmlCode: codeMap.get(\"html\") ?? \"\",\n    cssCode: cssParserResult.code,\n    scriptCode: scriptParserResult.code,\n  };\n};\n","import React, {\n  FC,\n  memo,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\";\nimport { PreviewProps } from \"./types\";\nimport classNames from \"classnames\";\nimport { codeParser } from \"./parser\";\nimport { useDebounceFn } from \"let-hooks/lib\";\nimport { CodeParserReturn } from \"./parser/type\";\nimport style from \"./style.module.scss\";\n\nconst Preview: FC<PreviewProps> = (props): JSX.Element => {\n  const codeMap = props.codeMap ?? new Map();\n  const [codeParserResult, setCodeParserResult] = useState<CodeParserReturn>();\n\n  const parseObj = useDebounceFn(() => {\n    setCodeParserResult(codeParser(codeMap))\n  }, 1000)\n\n  const srcDoc = useMemo(() => {\n    return `\n      <html lang=\"en\">\n      <head>\n          <meta charset=\"UTF-8\">\n          <meta name=\"apple-mobile-web-app-title\" content=\"code preview\">\n          <title>code preview</title>\n          <style>\n            * {\n              margin: 0;\n              padding: 0;\n            }\n            body {\n              width: 100vw;\n              height: 100vh;\n            }\n          </style>\n          ${codeParserResult?.importMap ?? \"\"}\n          ${codeParserResult?.cssCode ?? \"\"}\n      </head>\n      <body>\n      ${codeParserResult?.htmlCode ?? \"\"}\n      ${codeParserResult?.scriptCode ?? \"\"}\n      </body>\n      </html>\n    `;\n  }, [codeParserResult]);\n\n  useEffect(() => {\n    parseObj.run();\n  }, [codeMap])\n\n  return (\n    <iframe\n      srcDoc={srcDoc}\n      width=\"100%\"\n      className={classNames(style[\"iframe\"], props.className)}\n      title=\"code preview\"\n      sandbox=\"allow-forms allow-modals allow-pointer-lock allow-popups allow-same-origin allow-scripts allow-top-navigation-by-user-activation allow-downloads allow-presentation\"\n      allow=\"accelerometer; camera; encrypted-media; display-capture; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; web-share\"\n      scrolling=\"auto\"\n      allowTransparency\n      //   allowpaymentrequest=\"true\"\n      allowFullScreen\n      loading=\"lazy\"\n      frameBorder=\"none\"\n    />\n  );\n};\n\nexport default memo(Preview);\n","// import { memo } from \"react\"\n\nimport { FC, memo, useCallback, useState } from \"react\";\nimport { Request } from \"~/http/request\";\nimport { EmbedProps } from \"./types\";\nimport Preview from \"../../components/Previewer\";\nimport style from \"./style.module.scss\";\n\nconst Embed: FC<EmbedProps> = (props) => {\n  const [codeValue, _] = useState(\n    new Map<string, string>([\n      [\"javascript\", props.data?.javascript],\n      [\"css\", props.data?.css],\n      [\"html\", props.data?.html],\n    ])\n  );\n\n  const handleHome = useCallback(() => {\n    const url = \"https://vwood.xyz/tiny-code/\" + props.data.id;\n    window.open(url)\n  }, [])\n\n  const handleRerun = useCallback(() => {\n    location.reload();\n  }, [])\n\n  return (\n    <div className={style[\"embed\"]}>\n      <div className={style[\"embed-header\"]}>\n        <span className={style[\"embed-header-logo\"]} onClick={handleHome}>在线编辑</span>\n      </div>\n      <div  className={style[\"embed-iframe\"]}>\n        <Preview codeMap={codeValue} />\n      </div>\n      <div className={style[\"embed-footer\"]}>\n        <button onClick={handleRerun}>重新运行</button>\n      </div>\n    </div>\n  );\n};\n\nexport async function getStaticProps(context) {\n  const id = context.params.id;\n  // 获取当前id的代码信息\n  const res = await Request.getChecklessTinyCode(id);\n\n  return {\n    props: { data: res.data, id },\n  };\n}\n\nexport async function getStaticPaths() {\n  const res = await Request.getTinyCodeList({\n    pageNo: 0,\n    pageSize: 9999,\n  });\n\n  const tinyCodeList = res.data.data;\n  const paths = tinyCodeList.map((tinyCode) => ({\n    params: { id: tinyCode.id },\n  }));\n\n  return {\n    paths,\n    fallback: true, // false or 'blocking'\n  };\n}\n\nexport default memo(Embed);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"iframe\":\"style_iframe__kw_S7\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"embed\":\"style_embed__Ai8jv\",\"embed-header\":\"style_embed-header__PtGnP\",\"embed-header-logo\":\"style_embed-header-logo__RGkyF\",\"embed-iframe\":\"style_embed-iframe__9UUBv\",\"embed-footer\":\"style_embed-footer__IcqAM\"};","(self[\"webpackChunk_N_E\"] = self[\"webpackChunk_N_E\"] || []).push([[970],{\n\n/***/ 25380:\n/***/ (function(module) {\n\nfunction webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 25380;\nmodule.exports = webpackEmptyContext;\n\n/***/ }),\n\n/***/ 58862:\n/***/ (function(__unused_webpack_module, __unused_webpack_exports, __webpack_require__) {\n\n\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/tiny-code/embed/[id]\",\n      function () {\n        return __webpack_require__(43972);\n      }\n    ]);\n    if(false) {}\n  \n\n/***/ }),\n\n/***/ 38208:\n/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, {\n  \"Z\": function() { return /* binding */ Previewer; }\n});\n\n// EXTERNAL MODULE: ./node_modules/react/jsx-runtime.js\nvar jsx_runtime = __webpack_require__(85893);\n// EXTERNAL MODULE: ./node_modules/react/index.js\nvar react = __webpack_require__(67294);\n// EXTERNAL MODULE: ./node_modules/classnames/index.js\nvar classnames = __webpack_require__(94184);\nvar classnames_default = /*#__PURE__*/__webpack_require__.n(classnames);\n// EXTERNAL MODULE: ./node_modules/@babel/standalone/babel.js\nvar babel = __webpack_require__(12175);\n;// CONCATENATED MODULE: ./pages/tiny-code/components/Previewer/parser/scriptParser/babelTransform.ts\n\nconst getOptions = (scriptType)=>{\n    const config = {\n        presets: [],\n        plugins: []\n    };\n    switch(scriptType){\n        case \"typescript\":\n            config.plugins.push([\n                \"transform-typescript\"\n            ]);\n            break;\n        case \"react-js\":\n            config.presets.push(\"react\");\n            break;\n        case \"react-ts\":\n            config.presets.push(\"react\");\n            config.plugins.push([\n                \"transform-typescript\",\n                {\n                    isTSX: true\n                }\n            ]);\n            break;\n    }\n    return config;\n};\n// 添加依赖\nconst addDependencies = (scriptType)=>{\n    const imports = {};\n    switch(scriptType){\n        case \"react-js\":\n        case \"react-ts\":\n            imports.react = \"https://esm.sh/react\";\n            imports[\"react-dom\"] = \"https://esm.sh/react-dom\";\n            break;\n    }\n    return imports;\n};\nconst babelTransform = (scriptType, input)=>{\n    const outputCode = babel.transform(input, getOptions(scriptType)).code;\n    return '<script type=\"module\">'.concat(outputCode, \"</script>\");\n};\nconst transformScript = (scriptType, input)=>{\n    try {\n        return {\n            imports: addDependencies(scriptType),\n            code: babelTransform(scriptType, input)\n        };\n    } catch (err) {\n        console.error(err);\n        return {\n            imports: {},\n            code: \"\"\n        };\n    }\n};\n\n;// CONCATENATED MODULE: ./pages/tiny-code/components/Previewer/types.ts\nvar CSSType;\n(function(CSSType) {\n    CSSType[\"CSS\"] = \"css\";\n    CSSType[\"SASS\"] = \"sass\";\n    CSSType[\"LESS\"] = \"less\";\n})(CSSType || (CSSType = {}));\n\n;// CONCATENATED MODULE: ./pages/tiny-code/components/Previewer/parser/styleParser/cssParser.ts\nconst cssParser = (code)=>{\n    return {\n        code: '\\n    <script type=\"module\">\\n      let styleEle = document.getElementById(\"css\");\\n      if (!styleEle) {\\n        styleEle = document.createElement(\"style\");\\n        styleEle.id = \"css\";\\n        document.head.appendChild(styleEle);\\n      }\\n      styleEle.innerHTML = `'.concat(code, \"`;\\n    </script>\\n    \")\n    };\n};\n\n;// CONCATENATED MODULE: ./pages/tiny-code/components/Previewer/parser/styleParser/sassParser.ts\nconst sassParser = (code)=>{\n    return {\n        imports: {\n            sass: \"https://esm.sh/sass\"\n        },\n        code: '    \\n    <script type=\"module\">\\n      import * as sass from \\'sass\\';\\n    \\n      let styleEle = document.getElementById(\"css\");\\n      if (!styleEle) {\\n        styleEle = document.createElement(\"style\");\\n        styleEle.id = \"css\";\\n        document.head.appendChild(styleEle);\\n      }\\n      styleEle.innerHTML = sass.compileString(`'.concat(code, \"`)?.css;\\n    </script>\\n    \")\n    };\n};\n\n;// CONCATENATED MODULE: ./pages/tiny-code/components/Previewer/parser/styleParser/index.ts\n\n\n\nconst parserMap = {\n    [CSSType.SASS]: sassParser,\n    [CSSType.CSS]: cssParser\n};\nconst styleParser = function() {\n    let cssType = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : CSSType.CSS, css = arguments.length > 1 ? arguments[1] : void 0;\n    var ref;\n    return (ref = parserMap[cssType]) === null || ref === void 0 ? void 0 : ref.call(parserMap, css);\n};\n\n;// CONCATENATED MODULE: ./pages/tiny-code/components/Previewer/parser/utils.ts\nconst mergeImports = function() {\n    for(var _len = arguments.length, rest = new Array(_len), _key = 0; _key < _len; _key++){\n        rest[_key] = arguments[_key];\n    }\n    const imports = {};\n    rest.forEach((map)=>{\n        if (map) {\n            Object.assign(imports, map);\n        }\n    });\n    return imports;\n};\nconst importmapScript = (imports)=>{\n    const Obj = {\n        imports\n    };\n    return '<script type=\"importmap\">'.concat(JSON.stringify(Obj, undefined, 2), \"</script>\");\n};\n\n;// CONCATENATED MODULE: ./pages/tiny-code/components/Previewer/parser/index.ts\n\n\n\nconst codeParser = (codeMap)=>{\n    const cssParserResult = styleParser(codeMap.get(\"cssType\"), codeMap.get(\"css\"));\n    var ref;\n    const scriptParserResult = transformScript(codeMap.get(\"scriptType\"), (ref = codeMap.get(\"script\")) !== null && ref !== void 0 ? ref : \"\");\n    var ref1;\n    return {\n        importMap: importmapScript(mergeImports(cssParserResult.imports, scriptParserResult.imports)),\n        htmlCode: (ref1 = codeMap.get(\"html\")) !== null && ref1 !== void 0 ? ref1 : \"\",\n        cssCode: cssParserResult.code,\n        scriptCode: scriptParserResult.code\n    };\n};\n\n// EXTERNAL MODULE: ./node_modules/let-hooks/lib/index.js\nvar lib = __webpack_require__(95214);\n// EXTERNAL MODULE: ./pages/tiny-code/components/Previewer/style.module.scss\nvar style_module = __webpack_require__(16856);\nvar style_module_default = /*#__PURE__*/__webpack_require__.n(style_module);\n;// CONCATENATED MODULE: ./pages/tiny-code/components/Previewer/index.tsx\n\n\n\n\n\n\nconst Preview = (props)=>{\n    var _codeMap;\n    const codeMap = (_codeMap = props.codeMap) !== null && _codeMap !== void 0 ? _codeMap : new Map();\n    const [codeParserResult, setCodeParserResult] = (0,react.useState)();\n    const parseObj = (0,lib.useDebounceFn)(()=>{\n        setCodeParserResult(codeParser(codeMap));\n    }, 1000);\n    const srcDoc = (0,react.useMemo)(()=>{\n        var ref, ref1, ref2, ref3;\n        return '\\n      <html lang=\"en\">\\n      <head>\\n          <meta charset=\"UTF-8\">\\n          <meta name=\"apple-mobile-web-app-title\" content=\"code preview\">\\n          <title>code preview</title>\\n          <style>\\n            * {\\n              margin: 0;\\n              padding: 0;\\n            }\\n            body {\\n              width: 100vw;\\n              height: 100vh;\\n            }\\n          </style>\\n          '.concat((ref = codeParserResult === null || codeParserResult === void 0 ? void 0 : codeParserResult.importMap) !== null && ref !== void 0 ? ref : \"\", \"\\n          \").concat((ref1 = codeParserResult === null || codeParserResult === void 0 ? void 0 : codeParserResult.cssCode) !== null && ref1 !== void 0 ? ref1 : \"\", \"\\n      </head>\\n      <body>\\n      \").concat((ref2 = codeParserResult === null || codeParserResult === void 0 ? void 0 : codeParserResult.htmlCode) !== null && ref2 !== void 0 ? ref2 : \"\", \"\\n      \").concat((ref3 = codeParserResult === null || codeParserResult === void 0 ? void 0 : codeParserResult.scriptCode) !== null && ref3 !== void 0 ? ref3 : \"\", \"\\n      </body>\\n      </html>\\n    \");\n    }, [\n        codeParserResult\n    ]);\n    (0,react.useEffect)(()=>{\n        parseObj.run();\n    }, [\n        codeMap\n    ]);\n    return /*#__PURE__*/ (0,jsx_runtime.jsx)(\"iframe\", {\n        srcDoc: srcDoc,\n        width: \"100%\",\n        className: classnames_default()((style_module_default()).iframe, props.className),\n        title: \"code preview\",\n        sandbox: \"allow-forms allow-modals allow-pointer-lock allow-popups allow-same-origin allow-scripts allow-top-navigation-by-user-activation allow-downloads allow-presentation\",\n        allow: \"accelerometer; camera; encrypted-media; display-capture; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; web-share\",\n        scrolling: \"auto\",\n        allowTransparency: true,\n        //   allowpaymentrequest=\"true\"\n        allowFullScreen: true,\n        loading: \"lazy\",\n        frameBorder: \"none\"\n    });\n};\n/* harmony default export */ var Previewer = (/*#__PURE__*/(0,react.memo)(Preview));\n\n\n/***/ }),\n\n/***/ 43972:\n/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"__N_SSG\": function() { return /* binding */ __N_SSG; }\n/* harmony export */ });\n/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(85893);\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(67294);\n/* harmony import */ var _components_Previewer__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(38208);\n/* harmony import */ var _style_module_scss__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(67952);\n/* harmony import */ var _style_module_scss__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_style_module_scss__WEBPACK_IMPORTED_MODULE_3__);\n// import { memo } from \"react\"\n\n\n\n\nconst Embed = (props)=>{\n    var ref, ref1, ref2;\n    const [codeValue, _] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(new Map([\n        [\n            \"javascript\",\n            (ref = props.data) === null || ref === void 0 ? void 0 : ref.javascript\n        ],\n        [\n            \"css\",\n            (ref1 = props.data) === null || ref1 === void 0 ? void 0 : ref1.css\n        ],\n        [\n            \"html\",\n            (ref2 = props.data) === null || ref2 === void 0 ? void 0 : ref2.html\n        ]\n    ]));\n    const handleHome = (0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)(()=>{\n        const url = \"https://vwood.xyz/tiny-code/\" + props.data.id;\n        window.open(url);\n    }, []);\n    const handleRerun = (0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)(()=>{\n        location.reload();\n    }, []);\n    return /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(\"div\", {\n        className: (_style_module_scss__WEBPACK_IMPORTED_MODULE_3___default().embed),\n        children: [\n            /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\n                className: (_style_module_scss__WEBPACK_IMPORTED_MODULE_3___default()[\"embed-header\"]),\n                children: /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"span\", {\n                    className: (_style_module_scss__WEBPACK_IMPORTED_MODULE_3___default()[\"embed-header-logo\"]),\n                    onClick: handleHome,\n                    children: \"在线编辑\"\n                })\n            }),\n            /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\n                className: (_style_module_scss__WEBPACK_IMPORTED_MODULE_3___default()[\"embed-iframe\"]),\n                children: /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_Previewer__WEBPACK_IMPORTED_MODULE_2__/* [\"default\"] */ .Z, {\n                    codeMap: codeValue\n                })\n            }),\n            /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\n                className: (_style_module_scss__WEBPACK_IMPORTED_MODULE_3___default()[\"embed-footer\"]),\n                children: /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"button\", {\n                    onClick: handleRerun,\n                    children: \"重新运行\"\n                })\n            })\n        ]\n    });\n};\nvar __N_SSG = true;\n/* harmony default export */ __webpack_exports__[\"default\"] = (/*#__PURE__*/(0,react__WEBPACK_IMPORTED_MODULE_1__.memo)(Embed));\n\n\n/***/ }),\n\n/***/ 16856:\n/***/ (function(module) {\n\n// extracted by mini-css-extract-plugin\nmodule.exports = {\"iframe\":\"style_iframe__kw_S7\"};\n\n/***/ }),\n\n/***/ 67952:\n/***/ (function(module) {\n\n// extracted by mini-css-extract-plugin\nmodule.exports = {\"embed\":\"style_embed__Ai8jv\",\"embed-header\":\"style_embed-header__PtGnP\",\"embed-header-logo\":\"style_embed-header-logo__RGkyF\",\"embed-iframe\":\"style_embed-iframe__9UUBv\",\"embed-footer\":\"style_embed-footer__IcqAM\"};\n\n/***/ })\n\n},\n/******/ function(__webpack_require__) { // webpackRuntimeModules\n/******/ var __webpack_exec__ = function(moduleId) { return __webpack_require__(__webpack_require__.s = moduleId); }\n/******/ __webpack_require__.O(0, [33,214,774,888,179], function() { return __webpack_exec__(58862); });\n/******/ var __webpack_exports__ = __webpack_require__.O();\n/******/ _N_E = __webpack_exports__;\n/******/ }\n]);"],"names":["self","push","module","webpackEmptyContext","req","e","code","keys","resolve","id","exports","__unused_webpack_module","__unused_webpack_exports","__webpack_require__","window","__NEXT_P","__webpack_exports__","d","Previewer","CSSType","jsx_runtime","react","classnames","classnames_default","n","babel","getOptions","config","presets","plugins","scriptType","isTSX","addDependencies","imports","babelTransform","input","outputCode","transform","concat","transformScript","err","console","error","cssParser","sassParser","sass","parserMap","SASS","CSS","styleParser","ref","cssType","arguments","length","css","call","mergeImports","_len","rest","_key","forEach","map","Object","assign","importmapScript","JSON","stringify","undefined","codeParser","ref1","cssParserResult","codeMap","get","scriptParserResult","importMap","htmlCode","cssCode","scriptCode","lib","style_module","style_module_default","Preview","_codeMap","props","Map","codeParserResult","setCodeParserResult","useState","parseObj","useDebounceFn","srcDoc","useMemo","ref2","ref3","useEffect","run","jsx","width","className","iframe","title","sandbox","allow","scrolling","allowTransparency","allowFullScreen","loading","frameBorder","memo","r","__N_SSG","react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_1__","_components_Previewer__WEBPACK_IMPORTED_MODULE_2__","_style_module_scss__WEBPACK_IMPORTED_MODULE_3__","_style_module_scss__WEBPACK_IMPORTED_MODULE_3___default","Embed","codeValue","_","data","javascript","html","handleHome","useCallback","url","open","handleRerun","location","reload","jsxs","embed","children","onClick","Z","O","s","_N_E"],"sourceRoot":""}