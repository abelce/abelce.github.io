{"version":3,"file":"static/chunks/pages/tiny-code/embed/[id]-2a372ba61bb366bf.js","mappings":"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","sources":["webpack://_N_E/./node_modules/@babel/standalone/ sync","webpack://_N_E/?bb6b","webpack://_N_E/./pages/tiny-code/components/Previewer/parser/scriptParser/collectImportPlugin.ts","webpack://_N_E/./pages/tiny-code/components/Previewer/parser/scriptParser/babelTransform.ts","webpack://_N_E/./pages/tiny-code/components/Previewer/types.ts","webpack://_N_E/./pages/tiny-code/components/Previewer/parser/styleParser/cssParser.ts","webpack://_N_E/./pages/tiny-code/components/Previewer/parser/styleParser/sassParser.ts","webpack://_N_E/./pages/tiny-code/components/Previewer/parser/styleParser/index.ts","webpack://_N_E/./pages/tiny-code/components/Previewer/parser/utils.ts","webpack://_N_E/./pages/tiny-code/components/Previewer/parser/index.ts","webpack://_N_E/./pages/tiny-code/components/Previewer/index.tsx","webpack://_N_E/./pages/tiny-code/embed/[id]/index.page.tsx","webpack://_N_E/./pages/tiny-code/components/Previewer/style.module.scss","webpack://_N_E/./pages/tiny-code/embed/[id]/style.module.scss","webpack://_N_E/ignored|/Users/tzx/.jenkins/workspace/vwood/node_modules/browserslist|path","webpack://_N_E/ignored|/Users/tzx/.jenkins/workspace/vwood/node_modules/postcss/lib|./terminal-highlight","webpack://_N_E/ignored|/Users/tzx/.jenkins/workspace/vwood/node_modules/postcss/lib|fs","webpack://_N_E/ignored|/Users/tzx/.jenkins/workspace/vwood/node_modules/postcss/lib|path","webpack://_N_E/ignored|/Users/tzx/.jenkins/workspace/vwood/node_modules/postcss/lib|source-map-js","webpack://_N_E/<anon>"],"sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 25380;\nmodule.exports = webpackEmptyContext;","\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/tiny-code/embed/[id]\",\n      function () {\n        return require(\"private-next-pages/tiny-code/embed/[id]/index.page.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/tiny-code/embed/[id]\"])\n      });\n    }\n  ","let scriptImports = [];\nexport const getScriptImports = () => scriptImports;\nexport const resetScriptImports = () => {\n  scriptImports = [];\n};\n\nexport const collectImportPlugin = () => {\n  return {\n    visitor: {\n      ImportDeclaration(path) {\n        scriptImports.push(path.node.source.value);\n      },\n    },\n  };\n};\n","import * as Babel from \"@babel/standalone\";\nimport { ParserReturn } from \"../type\";\nimport { TransformOptions } from \"@babel/core\";\nimport {\n  collectImportPlugin,\n  getScriptImports,\n  resetScriptImports,\n} from \"./collectImportPlugin\";\n\nBabel.registerPlugin(\"collectImportPlugin\", collectImportPlugin);\n\nconst getOptions = (scriptType: string) => {\n  const config: TransformOptions = {\n    presets: [],\n    plugins: [\"collectImportPlugin\"],\n    // ast: true,\n  };\n  switch (scriptType) {\n    case \"typescript\":\n      config.plugins.push([\"transform-typescript\"]);\n      break;\n    case \"react-js\":\n      config.presets.push(\"react\");\n      break;\n    case \"react-ts\":\n      config.presets.push(\"react\");\n      config.plugins.push([\n        \"transform-typescript\",\n        {\n          isTSX: true,\n        },\n      ]);\n      break;\n  }\n  return config;\n};\n\nconst importNeedESMPrefix = (value: string): boolean => {\n  //判断import是否是以: http(s) | ./ | ../ | / 开头的，就不自动拼接esm\n  if (/^[http|\\.+/|\\/]/.test(value)) {\n    return false;\n  }\n  \n  return true;\n}\n\n// 添加依赖\nconst addDependencies = (scriptType: string): Record<string, string> => {\n  const imports: Record<string, string> = {};\n  // switch (scriptType) {\n  //   case \"react-js\":\n  //   case \"react-ts\":\n  //     imports.react = \"https://esm.sh/react\";\n  //     imports[\"react-dom\"] = \"https://esm.sh/react-dom\";\n  //     break;\n  // }\n\n  // 通过import自动拼接https://esm.sh/\n  const scriptImports = getScriptImports();\n  scriptImports.forEach((item) => {\n    if (importNeedESMPrefix(item)) {\n      imports[item] = `https://esm.sh/${item}`;\n    }\n  });\n\n  return imports;\n};\n\nconst babelTransform = (scriptType: string, input: string) => {\n  try {\n    const outputCode = Babel.transform(input, getOptions(scriptType)).code;\n    return `<script type=\"module\">${outputCode}</script>`;\n  } catch (err) {\n    return \"\";\n  }\n};\n\nexport const transformScript = (\n  scriptType: string,\n  input: string\n): ParserReturn => {\n  resetScriptImports();\n\n  const code = babelTransform(scriptType, input);\n\n  try {\n    return {\n      code,\n      imports: addDependencies(scriptType),\n    };\n  } catch (err) {\n    console.error(err);\n    return { imports: {}, code: \"\" };\n  }\n};\n","export interface PreviewProps {\n  css?: string;\n  cssType?: CSSType;\n  js?: string;\n  html?: string;\n  title?: string;\n  className?: string;\n  codeMap: Map<string, string>;\n}\n\nexport enum CSSType {\n  CSS = \"css\",\n  SASS = \"sass\",\n  LESS = \"less\",\n}\n","import { ParserReturn } from \"../type\";\n\nexport const cssParser = (code: string): ParserReturn => {\n  return {\n    code,\n  };\n};\n","import { ParserReturn } from \"../type\";\nimport * as sass from \"sass\";\n\nexport const sassParser = (code: string): ParserReturn => {\n  return {\n    code: sass.compileString(code).css,\n  };\n};\n","import { CSSType } from \"../../types\";\nimport { ParserReturn } from \"../type\";\nimport { cssParser } from \"./cssParser\";\nimport { sassParser } from \"./sassParser\";\nimport postcss from \"postcss\";\nimport autoprefixer from \"autoprefixer\";\nconst prefixer = postcss([autoprefixer]);\n\nexport const parserMap: Partial<\n  Record<CSSType, (code: string) => ParserReturn>\n> = {\n  [CSSType.SASS]: sassParser,\n  [CSSType.CSS]: cssParser,\n};\n\nexport const styleParser = async (\n  cssType: CSSType = CSSType.CSS,\n  css: string\n): Promise<ParserReturn> => {\n  const praserResult = parserMap[cssType]?.(css);\n  const postcssResult = await prefixer.process(praserResult.code);\n\n  return {\n    ...praserResult,\n    code: `<link href=\"https://esm.sh/normalize.css\" rel=\"stylesheet\" type=\"text/css\"><style>${postcssResult.css}</style>`,\n  };\n};\n","export const mergeImports = (\n  ...rest: Record<string, string>[]\n): Record<string, string> => {\n  const imports: Record<string, string> = {};\n  rest.forEach((map) => {\n    if (map) {\n      Object.assign(imports, map);\n    }\n  });\n\n  return imports;\n};\n\nexport const importmapScript = (imports: Record<string, string>): string => {\n  const Obj = {\n    imports,\n  };\n  return `<script type=\"importmap\">${JSON.stringify(Obj, undefined, 2)}</script>`;\n};\n","import { transformScript } from \"./scriptParser/babelTransform\";\nimport { styleParser } from \"./styleParser\";\nimport { CodeParserReturn } from \"./type\";\nimport { importmapScript, mergeImports } from \"./utils\";\n\nexport const codeParser = async (codeMap: Map<string, any>): Promise<CodeParserReturn> => {\n  const cssParserResult = await styleParser(\n    codeMap.get(\"cssType\"),\n    codeMap.get(\"css\")\n  );\n  const scriptParserResult = transformScript(\n    codeMap.get(\"scriptType\"),\n    codeMap.get(\"script\") ?? \"\"\n  );\n  return {\n    importMap: importmapScript(\n      mergeImports(cssParserResult.imports, scriptParserResult.imports)\n    ),\n    htmlCode: codeMap.get(\"html\") ?? \"\",\n    cssCode: cssParserResult.code,\n    scriptCode: scriptParserResult.code,\n  };\n};\n","import React, {\n  FC,\n  memo,\n  useEffect,\n  useMemo,\n  useState,\n} from \"react\";\nimport { PreviewProps } from \"./types\";\nimport classNames from \"classnames\";\nimport { codeParser } from \"./parser\";\nimport { useDebounceFn } from \"let-hooks/lib\";\nimport { CodeParserReturn } from \"./parser/type\";\nimport style from \"./style.module.scss\";\n\nconst Preview: FC<PreviewProps> = (props): JSX.Element => {\n  const codeMap = props.codeMap ?? new Map();\n  const [codeParserResult, setCodeParserResult] = useState<CodeParserReturn>();\n\n  const parseObj = useDebounceFn(async() => {\n   try {\n    const result = await codeParser(codeMap)\n    setCodeParserResult(result)\n   } catch (err) {\n    console.log(\"解析报错\")\n   }\n  }, 1000)\n\n  const srcDoc = useMemo(() => {\n    return `\n      <html lang=\"en\">\n      <head>\n          <meta charset=\"UTF-8\">\n          <meta name=\"apple-mobile-web-app-title\" content=\"code preview\">\n          <title>code preview</title>\n          ${codeParserResult?.importMap ?? \"\"}\n          ${codeParserResult?.cssCode ?? \"\"}\n      </head>\n      <body>\n      ${codeParserResult?.htmlCode ?? \"\"}\n      ${codeParserResult?.scriptCode ?? \"\"}\n      </body>\n      </html>\n    `;\n  }, [codeParserResult]);\n\n  useEffect(() => {\n    parseObj.run();\n  }, [codeMap])\n\n  return (\n    <iframe\n      srcDoc={srcDoc}\n      width=\"100%\"\n      className={classNames(style[\"iframe\"], props.className)}\n      title=\"code preview\"\n      sandbox=\"allow-forms allow-modals allow-pointer-lock allow-popups allow-same-origin allow-scripts allow-top-navigation-by-user-activation allow-downloads allow-presentation\"\n      allow=\"accelerometer; camera; encrypted-media; display-capture; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; web-share\"\n      scrolling=\"auto\"\n      allowTransparency\n      //   allowpaymentrequest=\"true\"\n      allowFullScreen\n      loading=\"lazy\"\n      frameBorder=\"none\"\n    />\n  );\n};\n\nexport default memo(Preview);\n","// import { memo } from \"react\"\n\nimport { FC, memo, useCallback, useState } from \"react\";\nimport { Request } from \"~/http/request\";\nimport { EmbedProps } from \"./types\";\nimport Preview from \"../../components/Previewer\";\nimport style from \"./style.module.scss\";\n\nconst Embed: FC<EmbedProps> = (props) => {\n  const [codeValue, _] = useState(\n    new Map<string, string>([\n      [\"javascript\", props.data?.javascript],\n      [\"css\", props.data?.css],\n      [\"html\", props.data?.html],\n    ])\n  );\n\n  const handleHome = useCallback(() => {\n    const url = \"https://vwood.xyz/tiny-code/\" + props.data.id;\n    window.open(url)\n  }, [])\n\n  const handleRerun = useCallback(() => {\n    location.reload();\n  }, [])\n\n  return (\n    <div className={style[\"embed\"]}>\n      <div className={style[\"embed-header\"]}>\n        <span className={style[\"embed-header-logo\"]} onClick={handleHome}>在线编辑</span>\n      </div>\n      <div  className={style[\"embed-iframe\"]}>\n        <Preview codeMap={codeValue} />\n      </div>\n      <div className={style[\"embed-footer\"]}>\n        <button onClick={handleRerun}>重新运行</button>\n      </div>\n    </div>\n  );\n};\n\nexport async function getStaticProps(context) {\n  const id = context.params.id;\n  // 获取当前id的代码信息\n  const res = await Request.getChecklessTinyCode(id);\n\n  return {\n    props: { data: res.data, id },\n  };\n}\n\nexport async function getStaticPaths() {\n  const res = await Request.getTinyCodeList({\n    pageNo: 0,\n    pageSize: 9999,\n  });\n\n  const tinyCodeList = res.data.data;\n  const paths = tinyCodeList.map((tinyCode) => ({\n    params: { id: tinyCode.id },\n  }));\n\n  return {\n    paths,\n    fallback: true, // false or 'blocking'\n  };\n}\n\nexport default memo(Embed);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"iframe\":\"style_iframe__kw_S7\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"embed\":\"style_embed__Ai8jv\",\"embed-header\":\"style_embed-header__PtGnP\",\"embed-header-logo\":\"style_embed-header-logo__RGkyF\",\"embed-iframe\":\"style_embed-iframe__9UUBv\",\"embed-footer\":\"style_embed-footer__IcqAM\"};","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","(self[\"webpackChunk_N_E\"] = self[\"webpackChunk_N_E\"] || []).push([[970],{\n\n/***/ 25380:\n/***/ (function(module) {\n\nfunction webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nwebpackEmptyContext.id = 25380;\nmodule.exports = webpackEmptyContext;\n\n/***/ }),\n\n/***/ 58862:\n/***/ (function(__unused_webpack_module, __unused_webpack_exports, __webpack_require__) {\n\n\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/tiny-code/embed/[id]\",\n      function () {\n        return __webpack_require__(43972);\n      }\n    ]);\n    if(false) {}\n  \n\n/***/ }),\n\n/***/ 71510:\n/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, {\n  \"Z\": function() { return /* binding */ Previewer; }\n});\n\n// EXTERNAL MODULE: ./node_modules/react/jsx-runtime.js\nvar jsx_runtime = __webpack_require__(85893);\n// EXTERNAL MODULE: ./node_modules/react/index.js\nvar react = __webpack_require__(67294);\n// EXTERNAL MODULE: ./node_modules/classnames/index.js\nvar classnames = __webpack_require__(94184);\nvar classnames_default = /*#__PURE__*/__webpack_require__.n(classnames);\n// EXTERNAL MODULE: ./node_modules/@babel/standalone/babel.js\nvar babel = __webpack_require__(12175);\n;// CONCATENATED MODULE: ./pages/tiny-code/components/Previewer/parser/scriptParser/collectImportPlugin.ts\nlet scriptImports = [];\nconst getScriptImports = ()=>scriptImports;\nconst resetScriptImports = ()=>{\n    scriptImports = [];\n};\nconst collectImportPlugin = ()=>{\n    return {\n        visitor: {\n            ImportDeclaration (path) {\n                scriptImports.push(path.node.source.value);\n            }\n        }\n    };\n};\n\n;// CONCATENATED MODULE: ./pages/tiny-code/components/Previewer/parser/scriptParser/babelTransform.ts\n\n\nbabel.registerPlugin(\"collectImportPlugin\", collectImportPlugin);\nconst getOptions = (scriptType)=>{\n    const config = {\n        presets: [],\n        plugins: [\n            \"collectImportPlugin\"\n        ]\n    };\n    switch(scriptType){\n        case \"typescript\":\n            config.plugins.push([\n                \"transform-typescript\"\n            ]);\n            break;\n        case \"react-js\":\n            config.presets.push(\"react\");\n            break;\n        case \"react-ts\":\n            config.presets.push(\"react\");\n            config.plugins.push([\n                \"transform-typescript\",\n                {\n                    isTSX: true\n                }\n            ]);\n            break;\n    }\n    return config;\n};\nconst importNeedESMPrefix = (value)=>{\n    //判断import是否是以: http(s) | ./ | ../ | / 开头的，就不自动拼接esm\n    if (/^[http|\\.+/|\\/]/.test(value)) {\n        return false;\n    }\n    return true;\n};\n// 添加依赖\nconst addDependencies = (scriptType)=>{\n    const imports = {};\n    // switch (scriptType) {\n    //   case \"react-js\":\n    //   case \"react-ts\":\n    //     imports.react = \"https://esm.sh/react\";\n    //     imports[\"react-dom\"] = \"https://esm.sh/react-dom\";\n    //     break;\n    // }\n    // 通过import自动拼接https://esm.sh/\n    const scriptImports = getScriptImports();\n    scriptImports.forEach((item)=>{\n        if (importNeedESMPrefix(item)) {\n            imports[item] = \"https://esm.sh/\".concat(item);\n        }\n    });\n    return imports;\n};\nconst babelTransform = (scriptType, input)=>{\n    try {\n        const outputCode = babel.transform(input, getOptions(scriptType)).code;\n        return '<script type=\"module\">'.concat(outputCode, \"</script>\");\n    } catch (err) {\n        return \"\";\n    }\n};\nconst transformScript = (scriptType, input)=>{\n    resetScriptImports();\n    const code = babelTransform(scriptType, input);\n    try {\n        return {\n            code,\n            imports: addDependencies(scriptType)\n        };\n    } catch (err) {\n        console.error(err);\n        return {\n            imports: {},\n            code: \"\"\n        };\n    }\n};\n\n;// CONCATENATED MODULE: ./pages/tiny-code/components/Previewer/types.ts\nvar CSSType;\n(function(CSSType) {\n    CSSType[\"CSS\"] = \"css\";\n    CSSType[\"SASS\"] = \"sass\";\n    CSSType[\"LESS\"] = \"less\";\n})(CSSType || (CSSType = {}));\n\n;// CONCATENATED MODULE: ./pages/tiny-code/components/Previewer/parser/styleParser/cssParser.ts\nconst cssParser = (code)=>{\n    return {\n        code\n    };\n};\n\n// EXTERNAL MODULE: ./node_modules/sass/sass.default.js\nvar sass_default = __webpack_require__(33707);\n;// CONCATENATED MODULE: ./pages/tiny-code/components/Previewer/parser/styleParser/sassParser.ts\n\nconst sassParser = (code)=>{\n    return {\n        code: sass_default/* compileString */.kM(code).css\n    };\n};\n\n// EXTERNAL MODULE: ./node_modules/postcss/lib/postcss.mjs\nvar postcss = __webpack_require__(39973);\n// EXTERNAL MODULE: ./node_modules/autoprefixer/lib/autoprefixer.js\nvar autoprefixer = __webpack_require__(19806);\nvar autoprefixer_default = /*#__PURE__*/__webpack_require__.n(autoprefixer);\n;// CONCATENATED MODULE: ./pages/tiny-code/components/Previewer/parser/styleParser/index.ts\n\n\n\n\n\nconst prefixer = (0,postcss/* default */.ZP)([\n    (autoprefixer_default())\n]);\nconst parserMap = {\n    [CSSType.SASS]: sassParser,\n    [CSSType.CSS]: cssParser\n};\nconst styleParser = async function() {\n    let cssType = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : CSSType.CSS, css = arguments.length > 1 ? arguments[1] : void 0;\n    var ref;\n    const praserResult = (ref = parserMap[cssType]) === null || ref === void 0 ? void 0 : ref.call(parserMap, css);\n    const postcssResult = await prefixer.process(praserResult.code);\n    return {\n        ...praserResult,\n        code: '<link href=\"https://esm.sh/normalize.css\" rel=\"stylesheet\" type=\"text/css\"><style>'.concat(postcssResult.css, \"</style>\")\n    };\n};\n\n;// CONCATENATED MODULE: ./pages/tiny-code/components/Previewer/parser/utils.ts\nconst mergeImports = function() {\n    for(var _len = arguments.length, rest = new Array(_len), _key = 0; _key < _len; _key++){\n        rest[_key] = arguments[_key];\n    }\n    const imports = {};\n    rest.forEach((map)=>{\n        if (map) {\n            Object.assign(imports, map);\n        }\n    });\n    return imports;\n};\nconst importmapScript = (imports)=>{\n    const Obj = {\n        imports\n    };\n    return '<script type=\"importmap\">'.concat(JSON.stringify(Obj, undefined, 2), \"</script>\");\n};\n\n;// CONCATENATED MODULE: ./pages/tiny-code/components/Previewer/parser/index.ts\n\n\n\nconst codeParser = async (codeMap)=>{\n    const cssParserResult = await styleParser(codeMap.get(\"cssType\"), codeMap.get(\"css\"));\n    var ref;\n    const scriptParserResult = transformScript(codeMap.get(\"scriptType\"), (ref = codeMap.get(\"script\")) !== null && ref !== void 0 ? ref : \"\");\n    var ref1;\n    return {\n        importMap: importmapScript(mergeImports(cssParserResult.imports, scriptParserResult.imports)),\n        htmlCode: (ref1 = codeMap.get(\"html\")) !== null && ref1 !== void 0 ? ref1 : \"\",\n        cssCode: cssParserResult.code,\n        scriptCode: scriptParserResult.code\n    };\n};\n\n// EXTERNAL MODULE: ./node_modules/let-hooks/lib/index.js\nvar lib = __webpack_require__(95214);\n// EXTERNAL MODULE: ./pages/tiny-code/components/Previewer/style.module.scss\nvar style_module = __webpack_require__(16856);\nvar style_module_default = /*#__PURE__*/__webpack_require__.n(style_module);\n;// CONCATENATED MODULE: ./pages/tiny-code/components/Previewer/index.tsx\n\n\n\n\n\n\nconst Preview = (props)=>{\n    var _codeMap;\n    const codeMap = (_codeMap = props.codeMap) !== null && _codeMap !== void 0 ? _codeMap : new Map();\n    const [codeParserResult, setCodeParserResult] = (0,react.useState)();\n    const parseObj = (0,lib.useDebounceFn)(async ()=>{\n        try {\n            const result = await codeParser(codeMap);\n            setCodeParserResult(result);\n        } catch (err) {\n            console.log(\"解析报错\");\n        }\n    }, 1000);\n    const srcDoc = (0,react.useMemo)(()=>{\n        var ref, ref1, ref2, ref3;\n        return '\\n      <html lang=\"en\">\\n      <head>\\n          <meta charset=\"UTF-8\">\\n          <meta name=\"apple-mobile-web-app-title\" content=\"code preview\">\\n          <title>code preview</title>\\n          '.concat((ref = codeParserResult === null || codeParserResult === void 0 ? void 0 : codeParserResult.importMap) !== null && ref !== void 0 ? ref : \"\", \"\\n          \").concat((ref1 = codeParserResult === null || codeParserResult === void 0 ? void 0 : codeParserResult.cssCode) !== null && ref1 !== void 0 ? ref1 : \"\", \"\\n      </head>\\n      <body>\\n      \").concat((ref2 = codeParserResult === null || codeParserResult === void 0 ? void 0 : codeParserResult.htmlCode) !== null && ref2 !== void 0 ? ref2 : \"\", \"\\n      \").concat((ref3 = codeParserResult === null || codeParserResult === void 0 ? void 0 : codeParserResult.scriptCode) !== null && ref3 !== void 0 ? ref3 : \"\", \"\\n      </body>\\n      </html>\\n    \");\n    }, [\n        codeParserResult\n    ]);\n    (0,react.useEffect)(()=>{\n        parseObj.run();\n    }, [\n        codeMap\n    ]);\n    return /*#__PURE__*/ (0,jsx_runtime.jsx)(\"iframe\", {\n        srcDoc: srcDoc,\n        width: \"100%\",\n        className: classnames_default()((style_module_default()).iframe, props.className),\n        title: \"code preview\",\n        sandbox: \"allow-forms allow-modals allow-pointer-lock allow-popups allow-same-origin allow-scripts allow-top-navigation-by-user-activation allow-downloads allow-presentation\",\n        allow: \"accelerometer; camera; encrypted-media; display-capture; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; web-share\",\n        scrolling: \"auto\",\n        allowTransparency: true,\n        //   allowpaymentrequest=\"true\"\n        allowFullScreen: true,\n        loading: \"lazy\",\n        frameBorder: \"none\"\n    });\n};\n/* harmony default export */ var Previewer = (/*#__PURE__*/(0,react.memo)(Preview));\n\n\n/***/ }),\n\n/***/ 43972:\n/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"__N_SSG\": function() { return /* binding */ __N_SSG; }\n/* harmony export */ });\n/* harmony import */ var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(85893);\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(67294);\n/* harmony import */ var _components_Previewer__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(71510);\n/* harmony import */ var _style_module_scss__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(67952);\n/* harmony import */ var _style_module_scss__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_style_module_scss__WEBPACK_IMPORTED_MODULE_3__);\n// import { memo } from \"react\"\n\n\n\n\nconst Embed = (props)=>{\n    var ref, ref1, ref2;\n    const [codeValue, _] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(new Map([\n        [\n            \"javascript\",\n            (ref = props.data) === null || ref === void 0 ? void 0 : ref.javascript\n        ],\n        [\n            \"css\",\n            (ref1 = props.data) === null || ref1 === void 0 ? void 0 : ref1.css\n        ],\n        [\n            \"html\",\n            (ref2 = props.data) === null || ref2 === void 0 ? void 0 : ref2.html\n        ]\n    ]));\n    const handleHome = (0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)(()=>{\n        const url = \"https://vwood.xyz/tiny-code/\" + props.data.id;\n        window.open(url);\n    }, []);\n    const handleRerun = (0,react__WEBPACK_IMPORTED_MODULE_1__.useCallback)(()=>{\n        location.reload();\n    }, []);\n    return /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(\"div\", {\n        className: (_style_module_scss__WEBPACK_IMPORTED_MODULE_3___default().embed),\n        children: [\n            /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\n                className: (_style_module_scss__WEBPACK_IMPORTED_MODULE_3___default()[\"embed-header\"]),\n                children: /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"span\", {\n                    className: (_style_module_scss__WEBPACK_IMPORTED_MODULE_3___default()[\"embed-header-logo\"]),\n                    onClick: handleHome,\n                    children: \"在线编辑\"\n                })\n            }),\n            /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\n                className: (_style_module_scss__WEBPACK_IMPORTED_MODULE_3___default()[\"embed-iframe\"]),\n                children: /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_Previewer__WEBPACK_IMPORTED_MODULE_2__/* [\"default\"] */ .Z, {\n                    codeMap: codeValue\n                })\n            }),\n            /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"div\", {\n                className: (_style_module_scss__WEBPACK_IMPORTED_MODULE_3___default()[\"embed-footer\"]),\n                children: /*#__PURE__*/ (0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(\"button\", {\n                    onClick: handleRerun,\n                    children: \"重新运行\"\n                })\n            })\n        ]\n    });\n};\nvar __N_SSG = true;\n/* harmony default export */ __webpack_exports__[\"default\"] = (/*#__PURE__*/(0,react__WEBPACK_IMPORTED_MODULE_1__.memo)(Embed));\n\n\n/***/ }),\n\n/***/ 16856:\n/***/ (function(module) {\n\n// extracted by mini-css-extract-plugin\nmodule.exports = {\"iframe\":\"style_iframe__kw_S7\"};\n\n/***/ }),\n\n/***/ 67952:\n/***/ (function(module) {\n\n// extracted by mini-css-extract-plugin\nmodule.exports = {\"embed\":\"style_embed__Ai8jv\",\"embed-header\":\"style_embed-header__PtGnP\",\"embed-header-logo\":\"style_embed-header-logo__RGkyF\",\"embed-iframe\":\"style_embed-iframe__9UUBv\",\"embed-footer\":\"style_embed-footer__IcqAM\"};\n\n/***/ }),\n\n/***/ 72950:\n/***/ (function() {\n\n/* (ignored) */\n\n/***/ }),\n\n/***/ 22868:\n/***/ (function() {\n\n/* (ignored) */\n\n/***/ }),\n\n/***/ 14777:\n/***/ (function() {\n\n/* (ignored) */\n\n/***/ }),\n\n/***/ 99830:\n/***/ (function() {\n\n/* (ignored) */\n\n/***/ }),\n\n/***/ 70209:\n/***/ (function() {\n\n/* (ignored) */\n\n/***/ })\n\n},\n/******/ function(__webpack_require__) { // webpackRuntimeModules\n/******/ var __webpack_exec__ = function(moduleId) { return __webpack_require__(__webpack_require__.s = moduleId); }\n/******/ __webpack_require__.O(0, [968,33,596,214,390,774,888,179], function() { return __webpack_exec__(58862); });\n/******/ var __webpack_exports__ = __webpack_require__.O();\n/******/ _N_E = __webpack_exports__;\n/******/ }\n]);"],"names":["self","push","module","webpackEmptyContext","req","e","code","keys","resolve","id","exports","__unused_webpack_module","__unused_webpack_exports","__webpack_require__","window","__NEXT_P","__webpack_exports__","d","Previewer","CSSType","jsx_runtime","react","classnames","classnames_default","n","babel","scriptImports","getScriptImports","resetScriptImports","collectImportPlugin","visitor","ImportDeclaration","path","node","source","value","registerPlugin","getOptions","config","presets","plugins","scriptType","isTSX","importNeedESMPrefix","test","addDependencies","imports","forEach","item","concat","babelTransform","input","outputCode","transform","err","transformScript","console","error","cssParser","sass_default","sassParser","kM","css","postcss","autoprefixer","autoprefixer_default","prefixer","ZP","parserMap","SASS","CSS","styleParser","ref","cssType","arguments","length","praserResult","call","postcssResult","process","mergeImports","_len","rest","_key","map","Object","assign","importmapScript","JSON","stringify","undefined","codeParser","codeMap","ref1","cssParserResult","get","scriptParserResult","importMap","htmlCode","cssCode","scriptCode","lib","style_module","style_module_default","Preview","_codeMap","props","Map","codeParserResult","setCodeParserResult","useState","parseObj","useDebounceFn","result","log","srcDoc","useMemo","ref2","ref3","useEffect","run","jsx","width","className","iframe","title","sandbox","allow","scrolling","allowTransparency","allowFullScreen","loading","frameBorder","memo","r","__N_SSG","react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_1__","_components_Previewer__WEBPACK_IMPORTED_MODULE_2__","_style_module_scss__WEBPACK_IMPORTED_MODULE_3__","_style_module_scss__WEBPACK_IMPORTED_MODULE_3___default","Embed","codeValue","_","data","javascript","html","handleHome","useCallback","url","open","handleRerun","location","reload","jsxs","embed","children","onClick","Z","O","s","_N_E"],"sourceRoot":""}