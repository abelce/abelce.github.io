{"pageProps":{"data":{"createTime":1692108471688,"css":".wrapper {\n    width: 70%;\n    max-width: 800px;\n    margin: 0 auto;\n}\n\nvideo {\n    max-width: 100%;\n}\n\n.wrapper>div {\n    margin-bottom: 10px;\n}\n\n.hidden {\n    display: none;\n}","html":"<div class=\"wrapper\">\n    <h1>点开“下载”按钮，“取消下载”按钮中止下载</h1>\n    <div class=\"controls\">\n        <button class=\"download\">下载</button>\n        <button class=\"abort hidden\">取消下载</button>\n        <p class=\"reports\"></p>\n        <div class=\"videoWrapper hidden\">\n            <p>Sintel © copyright Blender Foundation | <a href=\"http://www.sintel.org/\">www.sintel.org</a>.</p>\n        </div>\n    </div>\n</div>","id":"ac3baba0-0823-49f8-8aa3-1da93c96d528","javascript":"const url = 'https://vwood.xyz/images/sintel.mp4';\n\nconst videoWrapper = document.querySelector('.videoWrapper');\nconst downloadBtn = document.querySelector('.download');\nconst abortBtn = document.querySelector('.abort');\nconst reports = document.querySelector('.reports');\n\nlet controller;\nlet progressAnim;\nlet animCount = 0;\n\ndownloadBtn.addEventListener('click', fetchVideo);\n\nabortBtn.addEventListener('click', () => {\n    controller.abort();\n    console.log('Download aborted');\n    downloadBtn.classList.remove('hidden');\n});\n\nfunction fetchVideo() {\n    controller = new AbortController();\n    const signal = controller.signal;\n    downloadBtn.classList.add('hidden');\n    abortBtn.classList.remove('hidden');\n    reports.textContent = '视频下载中...';\n    fetch(url, {\n        signal\n    }).then((response) => {\n        if (response.status === 200) {\n            setTimeout(() => console.log('Body used: ', response.bodyUsed), 1);\n            return response.blob();\n        } else {\n            throw new Error('Failed to fetch');\n        }\n    }).then((myBlob) => {\n        const video = document.createElement('video');\n        video.setAttribute('controls', '');\n        video.src = URL.createObjectURL(myBlob);\n        videoWrapper.appendChild(video);\n\n        videoWrapper.classList.remove('hidden');\n        abortBtn.classList.add('hidden');\n        downloadBtn.classList.add('hidden');\n\n        reports.textContent = '视频准备完毕';\n    }).catch((e) => {\n        abortBtn.classList.add('hidden');\n        downloadBtn.classList.remove('hidden');\n        reports.textContent = '下载失败: ' + e.message;\n    })\n}","name":"abortController demo","operator":{"avatar":"//file.vwood.xyz/2023/06/11/upload_ssaf3w2dlo0xox7alrcrca1704a6j2fn.jpg","id":"96f16846-31f2-489c-9af0-d4ca13e836e4","name":"文钦"},"updateTime":1692111165460},"id":"ac3baba0-0823-49f8-8aa3-1da93c96d528"},"initialMobxState":{"userStore":{"currentUser":null,"users":[],"token":"","qiniuToken":"","userCount":0,"productCount":0,"commentCount":0,"settingType":"products"},"productStore":{"products":[],"total":0,"type":"","url":"","current":1,"product":null,"likesMap":{},"tabpane":"all","token":"","loading":false,"todayHunters":[],"today":[],"yesterday":[],"relatedProducts":[],"search":""},"commentStore":{"comments":[],"total":0,"current":0},"noteStore":{"token":"","notes":[],"total":0,"note":null},"askStore":{"token":"","asks":[],"total":0,"ask":null},"stypeStore":{"data":[]}},"__N_SSG":true}