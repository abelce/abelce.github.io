{"pageProps":{"data":{"createTime":1692108471688,"css":"   .wrapper {\n      width: 70%;\n      max-width: 800px;\n      margin: 0 auto;\n    }\n\n    video {\n      max-width: 100%;\n    }\n\n    .wrapper > div {\n      margin-bottom: 10px;\n    }\n\n    .hidden {\n      display: none;\n    }","html":"  <div class=\"wrapper\">\n    <h1>Simple offline video player</h1>\n    <div class=\"controls\">\n      <button class=\"download\">Download video</button>\n      <button class=\"abort hidden\">Cancel download</button>\n      <p class=\"reports\"></p>\n    </div>\n  </div>","id":"ac3baba0-0823-49f8-8aa3-1da93c96d528","javascript":" const url = 'https://vwood.xyz/images/sintel.mp4';\n\n  const videoWrapper = document.querySelector('.videoWrapper');\n  const downloadBtn = document.querySelector('.download');\n  const abortBtn = document.querySelector('.abort');\n  const reports = document.querySelector('.reports');\n\n  let controller;\n  let progressAnim;\n  let animCount = 0;\n\n  downloadBtn.addEventListener('click', fetchVideo);\n\n  abortBtn.addEventListener('click', () => {\n    controller.abort();\n    console.log('Download aborted');\n    downloadBtn.classList.remove('hidden');\n  });\n\n  function fetchVideo() {\n    controller = new AbortController();\n    const signal = controller.signal;\n    downloadBtn.classList.add('hidden');\n    abortBtn.classList.remove('hidden');\n    reports.textContent = 'Video awaiting download...';\n    fetch(url, { signal }).then((response) => {\n      if (response.status === 200) {\n        runAnimation();\n        setTimeout(() => console.log('Body used: ', response.bodyUsed), 1);\n        return response.blob();\n      } else {\n        throw new Error('Failed to fetch');\n      }\n    }).then((myBlob) => {\n      const video = document.createElement('video');\n      video.setAttribute('controls', '');\n      video.src = URL.createObjectURL(myBlob);\n      videoWrapper.appendChild(video);\n\n      videoWrapper.classList.remove('hidden');\n      abortBtn.classList.add('hidden');\n      downloadBtn.classList.add('hidden');\n\n      reports.textContent = 'Video ready to play';\n    }).catch((e) => {\n      abortBtn.classList.add('hidden');\n      downloadBtn.classList.remove('hidden');\n      reports.textContent = 'Download error: ' + e.message;\n    }).finally(() => {\n      clearInterval(progressAnim);\n      animCount = 0;\n    });\n  }\n\n  function runAnimation() {\n    progressAnim = setInterval(() => {\n      switch (animCount++ & 3) {\n        case 0: reports.textContent = 'Download occuring; waiting for video player to be constructed'; break;\n        case 1: reports.textContent = 'Download occuring; waiting for video player to be constructed.'; break;\n        case 2: reports.textContent = 'Download occuring; waiting for video player to be constructed..'; break;\n        case 3: reports.textContent = 'Download occuring; waiting for video player to be constructed...'; break;\n      }\n    }, 300);\n  }","name":"abortController demo","operator":{"avatar":"//file.vwood.xyz/2023/06/11/upload_ssaf3w2dlo0xox7alrcrca1704a6j2fn.jpg","id":"96f16846-31f2-489c-9af0-d4ca13e836e4","name":"文钦"},"updateTime":1692110404861},"id":"ac3baba0-0823-49f8-8aa3-1da93c96d528"},"initialMobxState":{"userStore":{"currentUser":null,"users":[],"token":"","qiniuToken":"","userCount":0,"productCount":0,"commentCount":0,"settingType":"products"},"productStore":{"products":[],"total":0,"type":"","url":"","current":1,"product":null,"likesMap":{},"tabpane":"all","token":"","loading":false,"todayHunters":[],"today":[],"yesterday":[],"relatedProducts":[],"search":""},"commentStore":{"comments":[],"total":0,"current":0},"noteStore":{"token":"","notes":[],"total":0,"note":null},"askStore":{"token":"","asks":[],"total":0,"ask":null},"stypeStore":{"data":[]}},"__N_SSG":true}