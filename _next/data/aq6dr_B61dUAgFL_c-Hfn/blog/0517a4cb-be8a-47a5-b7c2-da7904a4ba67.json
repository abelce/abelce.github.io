{"pageProps":{"data":{"category":{"id":"b741cc29-290b-44f7-a36b-2604cda6f43c","name":"typescript"},"content":"记录个人开发过程中postgres在docker中的使用\n\n## Dockerfile\n个人是在M1电脑上开发，所以`platform`使用`linux/amd64`来兼容amd芯片。\n\n```shell\nFROM --platform=linux/amd64 postgres:16.1-alpine\nCOPY ./poetrydb.sql /docker-entrypoint-initdb.d/poetrydb.sql\n```\n\n## 初始化脚本\n创建表时，数据使用`jsonb`的方式来存储数据，这样就可以少见很多列\n\npoetrydb.sql:\n```sql\nDROP TABLE IF EXISTS \"public\".\"tbl_poetry\";\nCREATE TABLE \"public\".\"tbl_poetry\" (\n\t\"id\" uuid NOT NULL,\n\t\"data\" jsonb NOT NULL\n)\nWITH (OIDS=FALSE);\nALTER TABLE \"public\".\"tbl_poetry\" OWNER TO \"postgres\";\n\n-- ----------------------------\n--  Primary key structure for table tbl_poetry\n-- ----------------------------\nALTER TABLE \"public\".\"tbl_poetry\" ADD PRIMARY KEY (\"id\") NOT DEFERRABLE INITIALLY IMMEDIATE;\n```\n\n## 打包命令\n\ndocker.sh:\n```shell\n #!/bin/bash\n docker build -t xxx/poetry_db:1.0.0 .\n docker push xxx/poetry_db:1.0.0\n```\n\n## 开发打包\n执行`sh docker.sh`打包并push镜像。\n\n## 图形化链接工具\n使用navicat Premium\n\n> Navicat Premium 是一套数据库管理工具，让你以单一程序同时连接到 MySQL、MariaDB、SQL Server、SQLite、Oracle 和 PostgreSQL 数据库。 此外，它与 Drizzle、OurDelta 和 Percona Server 兼容，并支持 Amazon RDS、Amazon Aurora、Amazon Redshift、SQL Azure、Oracle Cloud、Google Cloud和 OceanBase 等云数据库。\n\n点击链接，选择PostgreSQL\n![](https://file.vwood.xyz/2023/11/29/WX20231129-142336.png)\n\n输入链接名、主机、端口、数据库，用户名和密码，点击测试链接，成功后点击保存\n![](https://file.vwood.xyz/2023/11/29/WX20231129-142618.png)\n\n然后链接数据库就能看到数据啦\n![](https://file.vwood.xyz/2023/11/29/WX20231129-143353.png)\n\n\n## 索引\n如果数据量多找到查询变慢，可以对某些字段添加索引，比如:\n```sql\nCREATE INDEX index_createTime ON tbl_poetry  USING gin ((data->'createTime'));\n```\n\n## 总结\n总体来说还是比较简单的。\n\n","createTime":1701270093890,"creativeType":"original","description":"记录个人开发过程中postgres在docker中的使用\n\n Dockerfile\n个人是在M1电脑上开发，所以platform使用linux/amd64来兼容amd芯片。\n\nshell\nFROM --platform=linux/amd64 postgres:16.1-alpine\nCOPY ./poetrydb.sql /docker-entrypoint-initdb.d/","headerImg":"","id":"0517a4cb-be8a-47a5-b7c2-da7904a4ba67","isDeleted":false,"likeCount":0,"name":"docker使用postgres","operator":{"avatar":"//file.vwood.xyz/2023/06/11/upload_ssaf3w2dlo0xox7alrcrca1704a6j2fn.jpg","description":"","email":"1061225829@qq.com","github":"https://github.com/abelce","id":"96f16846-31f2-489c-9af0-d4ca13e836e4","name":"文钦"},"operatorId":"96f16846-31f2-489c-9af0-d4ca13e836e4","tags":["docker","postgres"],"updateTime":1701270093890,"viewCount":0},"id":"0517a4cb-be8a-47a5-b7c2-da7904a4ba67","latestArticleList":[{"id":"136338ed-c1f7-4127-ac2e-095c694cbb67","name":"升级macOS 13 Ventura系统后打开软件提示“已损坏，无法打开”解决方法","tags":[],"description":"","content":""},{"id":"ea2e43d0-d2c1-433e-b74f-1a163becef9d","name":"使用importmap实现在线代码编辑","tags":[],"description":"","content":""},{"id":"460fb164-5722-4cc2-ad6b-c35d5be4a670","name":"js提取iconfont项目的图标","tags":[],"description":"","content":""},{"id":"0517a4cb-be8a-47a5-b7c2-da7904a4ba67","name":"docker使用postgres","tags":[],"description":"","content":""},{"id":"cd89eea1-6839-499b-8573-5a487afc48ef","name":"babel配置文件加载","tags":[],"description":"","content":""}]},"initialMobxState":{"userStore":{"currentUser":null,"users":[],"token":"","qiniuToken":"","userCount":0,"productCount":0,"commentCount":0,"settingType":"products"},"productStore":{"products":[],"total":0,"type":"","url":"","current":1,"product":null,"likesMap":{},"tabpane":"all","token":"","loading":false,"todayHunters":[],"today":[],"yesterday":[],"relatedProducts":[],"search":""},"commentStore":{"comments":[],"total":0,"current":0},"noteStore":{"token":"","notes":[],"total":0,"note":null},"askStore":{"token":"","asks":[],"total":0,"ask":null},"stypeStore":{"data":[]}},"__N_SSG":true}