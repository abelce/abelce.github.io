(this["webpackJsonpbiz-form"]=this["webpackJsonpbiz-form"]||[]).push([[5],{899:function(e,t,n){"use strict";n.d(t,"a",(function(){return O}));var a=n(11),r=n(72),c=n(89),i=n(0),o=n(886),u=n(950),s=n(951),l=n(940),d=n(906),h=n(902),m=n.n(h),b=(n(903),n(3)),j="DragableBodyRow",p=function(e){var t=e.index,n=e.moveRow,o=e.className,l=e.style,d=Object(c.a)(e,["index","moveRow","className","style"]),h=Object(i.useRef)(),m=Object(u.a)({accept:j,collect:function(e){return(e.getItem()||{}).index===t?{}:{isOver:e.isOver(),dropClassName:" drop-over"}},drop:function(e){n(e.index,t)}}),p=Object(r.a)(m,2),O=p[0],y=O.isOver,f=O.dropClassName,v=p[1],x=Object(s.a)({type:j,item:{index:t},collect:function(e){return{isDragging:e.isDragging()}}});return v((0,Object(r.a)(x,2)[1])(h)),Object(b.jsx)("tr",Object(a.a)({ref:h,className:"".concat(o).concat(y?f:""),style:Object(a.a)({cursor:"move"},l)},d))},O=function(e){var t=e.onSort,n=e.dataSource,r=void 0===n?[]:n,u=Object(c.a)(e,["onSort","dataSource"]),s={body:{row:p}},h=Object(i.useCallback)((function(e,n){var a=r[e];t&&t(m()(r,{$splice:[[e,1],[n,0,a]]}))}),[r]);return Object(b.jsx)(l.a,{backend:d.a,children:Object(b.jsx)(o.a,Object(a.a)(Object(a.a)({},u),{},{dataSource:r,components:s,className:"sort-table",onRow:function(e,t){return{index:t,moveRow:h}}}))})}},900:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(11),r=n(20),c=n(72),i=n(0),o=n(948),u=n(256),s=n(3),l=function(e){var t=e.entityName,n=e.onCheck,a=(e.isTemplate,e.isMetadata,e.checkedKeys),l=Object(i.useState)([]),h=Object(c.a)(l,2),m=h[0],j=h[1];Object(i.useEffect)((function(){Object(u.e)(t).then((function(e){j(d(e,[]))}))}),[]);var p=Object(i.useCallback)((function(e,t){n&&n(t.node)}),[]);return Object(s.jsx)(o.a,{checkedKeys:a,loadData:function(e){var t=e.key,n=(e.children,e.fieldData),a=e.ancestors;return new Promise((function(e,c){Object(u.e)(n.referInfo.referEntityName).then((function(c){var i=d(c,["".concat(t)],[].concat(Object(r.a)(a),[n])),o=b(m,t,i);j(o),e(void 0)})).catch((function(){c()}))}))},treeData:m,checkable:!0,checkStrictly:!0,onCheck:p})};function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return h(e.fields,t,n)}function h(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return e.filter((function(e){return!e.isPrimary})).map((function(e){var a={key:m(t,"".concat(e.name)),title:"".concat(e.title),isLeaf:!0,fieldData:e,isRefer:!1,isCarry:t.length>0,ancestors:Object(r.a)(n)};return e.referInfo&&"refer"===e.bizType&&(a.key=m(t,"".concat(e.referInfo.aliasName||e.name)),a.isLeaf=!1,a.isRefer=!0),a}))}function m(e,t){return[].concat(Object(r.a)(e),[t]).join(".")}function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return e.map((function(e){return e.key===t?Object(a.a)(Object(a.a)({},e),{},{children:n}):e.children?Object(a.a)(Object(a.a)({},e),{},{children:b(e.children,t,n)}):e}))}},903:function(e,t,n){},925:function(e,t,n){e.exports={"template-container":"style_template-container__M6blv","template-content":"style_template-content__yO4bW","template-footer":"style_template-footer__8zJ_j"}},926:function(e,t,n){e.exports={"template-container":"style_template-container__zjTFN","template-content":"style_template-content__Kmcif","template-footer":"style_template-footer__1SWrP"}},927:function(e,t,n){e.exports={container:"style_container__mKZoL",sider:"style_sider___eprm"}},928:function(e,t,n){e.exports={valueType:"style_valueType__3lc2q"}},952:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return oe}));var a,r,c,i,o,u,s,l=n(28),d=n.n(l),h=n(38),m=n(10),b=n(12),j=n(13),p=n(16),O=n(17),y=n(4),f=n(390),v=n(296),x=n(58),C=n(0),k=n(36),g=n(949),S=n(55),N=n(67),q=n(925),I=n.n(q),w=n(306),_=n(307),P=n(367),K=n(926),Q=n.n(K),R=n(20),T=n(50),z=n(880),D=n(41),F=n(397),E=n(185),M=n(3),J=function(e){var t=e.onChange,n=e.handleRemove,a=e.entityName;D.a.getEntity(a);return[{dataIndex:"index",title:"\u5e8f\u53f7",render:function(e,t,n){return Object(M.jsx)("span",{children:n+1})},width:40},{dataIndex:"displayName",title:"\u540d\u79f0",render:function(e,n){return Object(M.jsx)(F.a,{size:"small",value:e,onChange:function(e){return t(n.path,"displayName",e.target.value)}})}},{dataIndex:"path",title:"\u8def\u5f84",width:200},{dataIndex:"visiable",title:"\u662f\u5426\u663e\u793a",render:function(e,n){return Object(M.jsx)(E.a,{checked:e,onChange:function(e){return t(n.path,"visiable",e.target.checked)}})}},{dataIndex:"isContextField",title:"\u4e0a\u4e0b\u6587",render:function(e,n){return Object(M.jsx)(E.a,{checked:e,onChange:function(e){return t(n.path,"isContextField",e.target.checked)}})}},{dataIndex:"isDisabledSummary",title:"\u662f\u5426\u5141\u8bb8\u6c47\u603b",render:function(e,n){return Object(M.jsx)(E.a,{checked:e,onChange:function(e){return t(n.path,"isDisabledSummary",e.target.checked)}})}},{dataIndex:"actions",title:"\u64cd\u4f5c",render:function(e,t){return Object(M.jsx)("div",{children:Object(M.jsx)(x.a,{type:"link",size:"small",onClick:function(){return n(t.path)},children:"\u5220\u9664"})})}}]},L=n(899),U=n(14),V=n(900),W=Object(S.a)((r=function(e){Object(p.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(m.a)(this,n),a=t.call(this,e),Object(y.a)(Object(j.a)(a),"handleItemChange",(function(e,t,n){a.props.queryColumn.updateQueryColumnItem(e,t,n)})),Object(y.a)(Object(j.a)(a),"handleOnCheck",(function(e){var t=a.props.queryColumn,n=e.key;t.pathExist(n)?t.removeQueryColumnItem(n):t.addItemFormQueryColumn(e)})),Object(y.a)(Object(j.a)(a),"handleOnSort",(function(e){a.props.queryColumn.setItems(e)})),Object(y.a)(Object(j.a)(a),"handleRemove",(function(e){a.props.queryColumn.removeQueryColumnItem(e)})),Object(y.a)(Object(j.a)(a),"getSortTableProps",(function(){return{onChange:a.handleItemChange,handleRemove:a.handleRemove,entityName:a.props.entityName}})),a}return Object(b.a)(n,[{key:"checkedKeys",get:function(){return this.props.queryColumn.items.map((function(e){return e.path}))}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return Object(M.jsxs)(z.a,{children:[Object(M.jsx)(z.a.Content,{children:Object(M.jsx)(L.a,{bordered:!0,size:"small",rowKey:"path",pagination:!1,dataSource:Object(R.a)(this.props.queryColumn.items),columns:J(this.getSortTableProps()),onSort:this.handleOnSort})}),Object(M.jsx)(z.a.Sider,{style:{width:"400px"},theme:"light",children:Object(M.jsx)(V.a,{checkedKeys:this.checkedKeys,entityName:this.props.entityName,onCheck:this.handleOnCheck})})]})}}]),n}(C.Component),Object(T.a)(r.prototype,"checkedKeys",[U.l],Object.getOwnPropertyDescriptor(r.prototype,"checkedKeys"),r.prototype),a=r))||a,A=n(62),B=(n(114),n(927)),Z=n.n(B),$=C.createContext(void 0),G=$.Provider,H=($.Consumer,n(207)),X=n(42),Y=n.n(X),ee=n(928),te=n.n(ee),ne=function(e){var t=e.onChange,n=e.handleRemove,a=e.entityName,r=D.a.getEntity(a);return[{dataIndex:"index",title:"\u5e8f\u53f7",render:function(e,t,n){return Object(M.jsx)("span",{children:n+1})}},{dataIndex:"displayName",title:"\u540d\u79f0",render:function(e,n){return Object(M.jsx)(F.a,{size:"small",value:e,onChange:function(e){return t(n.path,"displayName",e.target.value)}})}},{dataIndex:"valueType",title:"\u7c7b\u578b",render:function(e,n){return Object(M.jsx)(H.a,{className:te.a.valueType,value:e,path:n.path,bizType:(c=n.path,Y()(r.getField(c),"bizType","")),onChange:function(e){return t(n.path,"valueType",e)},entityName:a});var c}},{dataIndex:"path",title:"\u8def\u5f84"},{dataIndex:"isQuickQuery",title:"\u5feb\u6377\u67e5\u8be2",render:function(e,n){return Object(M.jsx)(E.a,{checked:e,onChange:function(e){return t(n.path,"isQuickQuery",e.target.checked)}})}},{dataIndex:"actions",title:"\u64cd\u4f5c",render:function(e,t){return Object(M.jsx)("div",{children:Object(M.jsx)(x.a,{type:"link",size:"small",onClick:function(){return n(t.path)},children:"\u5220\u9664"})})}}]},ae=Object(S.a)((i=function(e){Object(p.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(m.a)(this,n),a=t.call(this,e),Object(A.a)(Object(j.a)(a),"selectedFieldPath",o,Object(j.a)(a)),Object(y.a)(Object(j.a)(a),"handleOnSort",(function(e){a.props.querySchema.setItems(e)})),Object(y.a)(Object(j.a)(a),"handleRemove",(function(e){a.props.querySchema.removeQuerySchemaItem(e)})),Object(y.a)(Object(j.a)(a),"getSortTableProps",(function(){return{onChange:a.handleItemChange,handleRemove:a.handleRemove,entityName:a.props.entityName}})),Object(y.a)(Object(j.a)(a),"handleItemChange",(function(e,t,n){a.props.querySchema.updateQuerySchemaItem(e,t,n)})),Object(y.a)(Object(j.a)(a),"handleOnCheck",(function(e){var t=a.props.querySchema,n=e.key;t.pathExist(n)?t.removeQuerySchemaItem(n):t.addItemFormQuerySchema(e)})),a.state={selectedFieldPath:""},a}return Object(b.a)(n,[{key:"selectedKeys",get:function(){return this.props.querySchema}},{key:"fieldProviderValue",get:function(){var e=this;return{selectedFieldPath:this.state.selectedFieldPath,onClick:function(t){e.setState({selectedFieldPath:t})}}}},{key:"render",value:function(){return this.props.querySchema?Object(M.jsx)(G,{value:this.fieldProviderValue,children:Object(M.jsxs)(z.a,{className:Z.a.container,children:[Object(M.jsx)(z.a.Content,{className:Z.a.content,children:Object(M.jsx)(L.a,{bordered:!0,size:"small",rowKey:"path",pagination:!1,dataSource:Object(R.a)(this.props.querySchema.items),columns:ne(this.getSortTableProps()),onSort:this.handleOnSort})}),Object(M.jsx)(z.a.Sider,{theme:"light",className:Z.a.sider,children:Object(M.jsx)(V.a,{checkedKeys:this.props.querySchema.paths(),entityName:this.props.entityName,onCheck:this.handleOnCheck})})]})}):null}}]),n}(C.Component),o=Object(T.a)(i.prototype,"selectedFieldPath",[U.A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Object(T.a)(i.prototype,"selectedKeys",[U.l],Object.getOwnPropertyDescriptor(i.prototype,"selectedKeys"),i.prototype),c=i))||c,re=g.a.TabPane,ce=[{key:"queryColumn",title:"\u5217\u8868\u9879",Component:W},{key:"querySchema",title:"\u67e5\u8be2\u9879",Component:ae}],ie=Object(S.a)(u=function(e){Object(p.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(m.a)(this,n),a=t.call(this,e),Object(y.a)(Object(j.a)(a),"presenter",void 0),Object(y.a)(Object(j.a)(a),"state",{loading:!0,activeKey:"queryColumn"}),Object(y.a)(Object(j.a)(a),"init",Object(h.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({loading:!1});case 1:case"end":return e.stop()}}),e)})))),Object(y.a)(Object(j.a)(a),"handleItemChange",(function(e,t,n){a.queryColumn.updateQueryColumnItem(e,t,n)})),Object(y.a)(Object(j.a)(a),"handleOnCheck",(function(e){a.queryColumn.addItemFormQueryColumn(e),a.forceUpdate()})),Object(y.a)(Object(j.a)(a),"handleOnSort",(function(e){a.queryColumn.setItems(e),a.forceUpdate()})),Object(y.a)(Object(j.a)(a),"handleSave",Object(h.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))),Object(y.a)(Object(j.a)(a),"handleTabChange",(function(e){a.setState({activeKey:e})})),Object(y.a)(Object(j.a)(a),"tabsRender",(function(){var e=a.state.activeKey;return Object(M.jsx)(g.a,{activeKey:e,onChange:a.handleTabChange,children:ce.map((function(e){var t=e.title,n=e.key,r=e.Component;return Object(M.jsx)(re,{tab:t,children:Object(M.jsx)(r,{entityName:a.entityName,queryColumn:a.queryColumn,querySchema:a.querySchema})},n)}))})})),a.presenter=e.presenter,a}return Object(b.a)(n,[{key:"entityName",get:function(){return this.presenter.entityName}},{key:"queryColumn",get:function(){return this.presenter.queryColumn}},{key:"querySchema",get:function(){return this.presenter.querySchema}},{key:"componentDidMount",value:function(){this.init()}},{key:"render",value:function(){return this.queryColumn?Object(M.jsx)(v.a,{className:Q.a["template-container"],spinning:!this.queryColumn,children:this.tabsRender()}):null}}]),n}(C.Component))||u,oe=(g.a.TabPane,Object(S.a)(s=function(e){Object(p.a)(n,e);var t=Object(O.a)(n);function n(e){var a;Object(m.a)(this,n),a=t.call(this,e),Object(y.a)(Object(j.a)(a),"entityName",void 0),Object(y.a)(Object(j.a)(a),"queryColumn",void 0),Object(y.a)(Object(j.a)(a),"querySchema",void 0),Object(y.a)(Object(j.a)(a),"mode",void 0),Object(y.a)(Object(j.a)(a),"presenter",void 0),Object(y.a)(Object(j.a)(a),"init",Object(h.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.getQueryColumn();case 3:return e.next=5,a.getQuerySchema();case 5:a.presenter=new P.a({entityName:a.entityName,querySchema:a.querySchema,queryColumn:a.queryColumn}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),f.b.error("\u521d\u59cb\u5316\u5931\u8d25");case 11:return e.prev=11,a.setState({loading:!1}),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[0,8,11,14]])})))),Object(y.a)(Object(j.a)(a),"getQueryColumn",Object(h.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(w.b)(a.entityName);case 2:(t=e.sent)||(t={entityName:a.entityName,items:[]}),a.queryColumn=t;case 5:case"end":return e.stop()}}),e)})))),Object(y.a)(Object(j.a)(a),"getQuerySchema",Object(h.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(_.b)(a.entityName);case 2:(t=e.sent)||(t={entityName:a.entityName,items:[]}),a.querySchema=t;case 5:case"end":return e.stop()}}),e)})))),Object(y.a)(Object(j.a)(a),"handleSave",Object(h.a)(d.a.mark((function e(){var t,n,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.presenter.toJSON(),n=t.queryColumn,r=t.querySchema,e.prev=1,!n.id){e.next=7;break}return e.next=5,Object(w.c)(n);case 5:e.next=9;break;case 7:return e.next=9,Object(w.a)(n);case 9:if(!r.id){e.next=14;break}return e.next=12,Object(_.d)(r);case 12:e.next=16;break;case 14:return e.next=16,Object(_.a)(r);case 16:f.b.success("\u4fdd\u5b58\u6210\u529f"),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(1),console.error(e.t0),f.b.error("\u4fdd\u5b58\u5931\u8d25");case 23:case"end":return e.stop()}}),e,null,[[1,19]])})))),Object(y.a)(Object(j.a)(a),"renderContent",(function(){return Object(M.jsx)(N.a,{children:function(){return Object(M.jsx)(ie,{presenter:a.presenter})}})}));var r=e.match.params;return a.state={loading:!0},a.entityName=r.entityName,a.mode=r.mode||k.a.Create,a}return Object(b.a)(n,[{key:"componentDidMount",value:function(){this.init()}},{key:"render",value:function(){return this.state.loading&&!this.presenter?null:Object(M.jsxs)(v.a,{className:I.a["template-container"],spinning:!this.queryColumn,children:[this.renderContent(),Object(M.jsx)("div",{className:I.a["template-footer"],children:Object(M.jsx)(x.a,{type:"primary",onClick:this.handleSave,children:"\u4fdd\u5b58"})})]})}}]),n}(C.Component))||s)}}]);
//# sourceMappingURL=5.bbf2ec6a.chunk.js.map